{"repository_name":"socialize","body":"# Socialize\nA library that implements the PubsubHubbub protocol.\n\n## Introduction\nThis library is a Crystal implementation of the PubSubHubbub protocol that was created in 2014. As of v0.1.0, verification of a subscription, subscribing to a topic, and discovery of topic hubs are handled within the libray. Broadcasting topic updates to subscribers is not covered, but will be added in later versions.\n\n## Key Differences\nThe original spec doesn't mention a transfer format, but most implementations that I saw used XML. I chose to use JSON. I also didn't adhere to any microformats that are used in other implementations, but this is on the TODO list. \n\n## Usage\nAccording to the spec, hub links are supposed to live in the HEAD of a HTML document. To find the hub links that a user can subscribe do the following:\n\n```\nrequire \"socialize\"\nhublink = Socialize::Discovery::discover_feed_link(all_html_between_the_head_tags)\n\nputs hublink.link # prints the hub url\n```\n\nTo subscribe to hub's topic just provide your secret challenge value. This will be used to verify your subscription to the hub:\n\n```\nrequire \"socialize\"\ntopic = Socialize::Topic.new \"myTopic\" hublink.link\nresp = topic.subscribe(\"mySecretChallenge\")\n```\n\nTo verify your subscription:\n\n```\nrequire \"socialize\"\ntopic.verify_challenge()\n```\n\n","program":{"html_id":"socialize/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"socialize","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"socialize/Socialize","path":"Socialize.html","kind":"module","full_name":"Socialize","name":"Socialize","abstract":false,"locations":[{"filename":"src/main.cr","line_number":7,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L7"},{"filename":"src/types.cr","line_number":1,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L1"}],"repository_name":"socialize","program":false,"enum":false,"alias":false,"const":false,"types":[{"html_id":"socialize/Socialize/Content","path":"Socialize/Content.html","kind":"class","full_name":"Socialize::Content","name":"Content","abstract":false,"superclass":{"html_id":"socialize/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"socialize/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"socialize/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/main.cr","line_number":9,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L9"}],"repository_name":"socialize","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"socialize/Socialize","kind":"module","full_name":"Socialize","name":"Socialize"},"constructors":[{"html_id":"new(title:String,type:Socialize::ContentType)-class-method","name":"new","abstract":false,"args":[{"name":"title","external_name":"title","restriction":"::String"},{"name":"type","external_name":"type","restriction":"::Socialize::ContentType"}],"args_string":"(title : String, type : Socialize::ContentType)","args_html":"(title : String, type : <a href=\"../Socialize/ContentType.html\">Socialize::ContentType</a>)","location":{"filename":"src/main.cr","line_number":15,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L15"},"def":{"name":"new","args":[{"name":"title","external_name":"title","restriction":"::String"},{"name":"type","external_name":"type","restriction":"::Socialize::ContentType"}],"visibility":"Public","body":"_ = allocate\n_.initialize(title, type)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"author:String-instance-method","name":"author","abstract":false,"location":{"filename":"src/main.cr","line_number":13,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L13"},"def":{"name":"author","return_type":"String","visibility":"Public","body":"@author"}},{"html_id":"author=(author:String)-instance-method","name":"author=","abstract":false,"args":[{"name":"author","external_name":"author","restriction":"String"}],"args_string":"(author : String)","args_html":"(author : String)","location":{"filename":"src/main.cr","line_number":13,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L13"},"def":{"name":"author=","args":[{"name":"author","external_name":"author","restriction":"String"}],"visibility":"Public","body":"@author = author"}},{"html_id":"convert_type_to_string-instance-method","name":"convert_type_to_string","abstract":false,"location":{"filename":"src/main.cr","line_number":20,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L20"},"def":{"name":"convert_type_to_string","visibility":"Public","body":"case @type\nwhen .photo?\n  return \"Photo\"\nwhen .short_message?\n  return \"ShortMessage\"\nwhen .article?\n  return \"Article\"\nwhen .link?\n  return \"Link\"\nwhen .video?\n  return \"Video\"\nend"}},{"html_id":"published:Time-instance-method","name":"published","abstract":false,"location":{"filename":"src/main.cr","line_number":14,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L14"},"def":{"name":"published","return_type":"Time","visibility":"Public","body":"@published"}},{"html_id":"published=(published:Time)-instance-method","name":"published=","abstract":false,"args":[{"name":"published","external_name":"published","restriction":"Time"}],"args_string":"(published : Time)","args_html":"(published : Time)","location":{"filename":"src/main.cr","line_number":14,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L14"},"def":{"name":"published=","args":[{"name":"published","external_name":"published","restriction":"Time"}],"visibility":"Public","body":"@published = published"}},{"html_id":"text:String-instance-method","name":"text","abstract":false,"location":{"filename":"src/main.cr","line_number":11,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L11"},"def":{"name":"text","return_type":"String","visibility":"Public","body":"@text"}},{"html_id":"text=(text:String)-instance-method","name":"text=","abstract":false,"args":[{"name":"text","external_name":"text","restriction":"String"}],"args_string":"(text : String)","args_html":"(text : String)","location":{"filename":"src/main.cr","line_number":11,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L11"},"def":{"name":"text=","args":[{"name":"text","external_name":"text","restriction":"String"}],"visibility":"Public","body":"@text = text"}},{"html_id":"title:String-instance-method","name":"title","abstract":false,"location":{"filename":"src/main.cr","line_number":10,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L10"},"def":{"name":"title","return_type":"String","visibility":"Public","body":"@title"}},{"html_id":"title=(title:String)-instance-method","name":"title=","abstract":false,"args":[{"name":"title","external_name":"title","restriction":"String"}],"args_string":"(title : String)","args_html":"(title : String)","location":{"filename":"src/main.cr","line_number":10,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L10"},"def":{"name":"title=","args":[{"name":"title","external_name":"title","restriction":"String"}],"visibility":"Public","body":"@title = title"}},{"html_id":"to_JSON-instance-method","name":"to_JSON","abstract":false,"location":{"filename":"src/main.cr","line_number":34,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L34"},"def":{"name":"to_JSON","visibility":"Public","body":"return JSON.build do |json|\n  json.object do\n    json.field(\"title\", @title)\n    json.field(\"text\", @text)\n    json.field(\"type\", convert_type_to_string)\n    json.field(\"author\", @author)\n    json.field(\"published\", @published.to_s)\n  end\nend"}},{"html_id":"type:ContentType-instance-method","name":"type","abstract":false,"location":{"filename":"src/main.cr","line_number":12,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L12"},"def":{"name":"type","return_type":"ContentType","visibility":"Public","body":"@type"}},{"html_id":"type=(type:ContentType)-instance-method","name":"type=","abstract":false,"args":[{"name":"type","external_name":"type","restriction":"ContentType"}],"args_string":"(type : ContentType)","args_html":"(type : <a href=\"../Socialize/ContentType.html\">ContentType</a>)","location":{"filename":"src/main.cr","line_number":12,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L12"},"def":{"name":"type=","args":[{"name":"type","external_name":"type","restriction":"ContentType"}],"visibility":"Public","body":"@type = type"}}]},{"html_id":"socialize/Socialize/ContentType","path":"Socialize/ContentType.html","kind":"enum","full_name":"Socialize::ContentType","name":"ContentType","abstract":false,"ancestors":[{"html_id":"socialize/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"socialize/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"socialize/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"socialize/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/types.cr","line_number":2,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L2"}],"repository_name":"socialize","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"Photo","name":"Photo","value":"0"},{"id":"ShortMessage","name":"ShortMessage","value":"1"},{"id":"Article","name":"Article","value":"2"},{"id":"Link","name":"Link","value":"3"},{"id":"Video","name":"Video","value":"4"}],"namespace":{"html_id":"socialize/Socialize","kind":"module","full_name":"Socialize","name":"Socialize"},"instance_methods":[{"html_id":"article?-instance-method","name":"article?","abstract":false,"location":{"filename":"src/types.cr","line_number":5,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L5"},"def":{"name":"article?","visibility":"Public","body":"self == Article"}},{"html_id":"link?-instance-method","name":"link?","abstract":false,"location":{"filename":"src/types.cr","line_number":6,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L6"},"def":{"name":"link?","visibility":"Public","body":"self == Link"}},{"html_id":"photo?-instance-method","name":"photo?","abstract":false,"location":{"filename":"src/types.cr","line_number":3,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L3"},"def":{"name":"photo?","visibility":"Public","body":"self == Photo"}},{"html_id":"short_message?-instance-method","name":"short_message?","abstract":false,"location":{"filename":"src/types.cr","line_number":4,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L4"},"def":{"name":"short_message?","visibility":"Public","body":"self == ShortMessage"}},{"html_id":"video?-instance-method","name":"video?","abstract":false,"location":{"filename":"src/types.cr","line_number":7,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L7"},"def":{"name":"video?","visibility":"Public","body":"self == Video"}}]},{"html_id":"socialize/Socialize/Discovery","path":"Socialize/Discovery.html","kind":"class","full_name":"Socialize::Discovery","name":"Discovery","abstract":false,"superclass":{"html_id":"socialize/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"socialize/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"socialize/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/main.cr","line_number":48,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L48"}],"repository_name":"socialize","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"socialize/Socialize","kind":"module","full_name":"Socialize","name":"Socialize"},"class_methods":[{"html_id":"discover_feed_link(head_text:String)-class-method","name":"discover_feed_link","abstract":false,"args":[{"name":"head_text","external_name":"head_text","restriction":"String"}],"args_string":"(head_text : String)","args_html":"(head_text : String)","location":{"filename":"src/main.cr","line_number":49,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L49"},"def":{"name":"discover_feed_link","args":[{"name":"head_text","external_name":"head_text","restriction":"String"}],"visibility":"Public","body":"url = \"\"\nrel = \"\"\nhead_html = Lexbor::Parser.new(head_text)\n(head_html.nodes(:link)).each do |node|\n  rel = node.attribute_by(\"rel\")\n  if rel == \"hub\"\n    url = node.attribute_by(\"href\")\n  end\nend\nif url == \"\"\n  raise(NoHubLinkError.new)\nelse\n  return HubLink.new(url.as(String))\nend\n"}}]},{"html_id":"socialize/Socialize/HubLink","path":"Socialize/HubLink.html","kind":"class","full_name":"Socialize::HubLink","name":"HubLink","abstract":false,"superclass":{"html_id":"socialize/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"socialize/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"socialize/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/types.cr","line_number":10,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L10"}],"repository_name":"socialize","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"socialize/Socialize","kind":"module","full_name":"Socialize","name":"Socialize"},"constructors":[{"html_id":"new(t:String)-class-method","name":"new","abstract":false,"args":[{"name":"t","external_name":"t","restriction":"::String"}],"args_string":"(t : String)","args_html":"(t : String)","location":{"filename":"src/types.cr","line_number":13,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L13"},"def":{"name":"new","args":[{"name":"t","external_name":"t","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(t)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"link:String-instance-method","name":"link","abstract":false,"location":{"filename":"src/types.cr","line_number":16,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L16"},"def":{"name":"link","visibility":"Public","body":"@link"}}]},{"html_id":"socialize/Socialize/NoHubLinkError","path":"Socialize/NoHubLinkError.html","kind":"class","full_name":"Socialize::NoHubLinkError","name":"NoHubLinkError","abstract":false,"superclass":{"html_id":"socialize/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"socialize/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"socialize/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"socialize/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/types.cr","line_number":21,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/types.cr#L21"}],"repository_name":"socialize","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"socialize/Socialize","kind":"module","full_name":"Socialize","name":"Socialize"}},{"html_id":"socialize/Socialize/Topic","path":"Socialize/Topic.html","kind":"class","full_name":"Socialize::Topic","name":"Topic","abstract":false,"superclass":{"html_id":"socialize/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"socialize/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"socialize/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/main.cr","line_number":67,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L67"}],"repository_name":"socialize","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"socialize/Socialize","kind":"module","full_name":"Socialize","name":"Socialize"},"constructors":[{"html_id":"new(topic_name:String,base_url:String)-class-method","name":"new","abstract":false,"args":[{"name":"topic_name","external_name":"topic_name","restriction":"::String"},{"name":"base_url","external_name":"base_url","restriction":"::String"}],"args_string":"(topic_name : String, base_url : String)","args_html":"(topic_name : String, base_url : String)","location":{"filename":"src/main.cr","line_number":72,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L72"},"def":{"name":"new","args":[{"name":"topic_name","external_name":"topic_name","restriction":"::String"},{"name":"base_url","external_name":"base_url","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(topic_name, base_url)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"fill_subscribers(sublist:Array(String))-instance-method","name":"fill_subscribers","abstract":false,"args":[{"name":"sublist","external_name":"sublist","restriction":"Array(String)"}],"args_string":"(sublist : Array(String))","args_html":"(sublist : Array(String))","location":{"filename":"src/main.cr","line_number":85,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L85"},"def":{"name":"fill_subscribers","args":[{"name":"sublist","external_name":"sublist","restriction":"Array(String)"}],"visibility":"Public","body":"@subscribers = sublist"}},{"html_id":"subscribe(secret:String)-instance-method","name":"subscribe","abstract":false,"args":[{"name":"secret","external_name":"secret","restriction":"String"}],"args_string":"(secret : String)","args_html":"(secret : String)","location":{"filename":"src/main.cr","line_number":91,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L91"},"def":{"name":"subscribe","args":[{"name":"secret","external_name":"secret","restriction":"String"}],"visibility":"Public","body":"headers = HTTP::Headers {\"Content-Type\" => \"application/json\", \"X-Challenge-Secret\" => secret}\nresponse = HTTP::Client.post(@base_url, headers: headers)\nif response.status_code == 200\n  return JSON.parse(response.body)\nend\nreturn JSON.parse(\"{\\\"error\\\": \\\"Did not subscribe to topic\\\"}\")\n"}},{"html_id":"subscriber_list:Array(String)-instance-method","name":"subscriber_list","abstract":false,"location":{"filename":"src/main.cr","line_number":88,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L88"},"def":{"name":"subscriber_list","visibility":"Public","body":"@subscribers"}},{"html_id":"verify_challenge(headers:HTTP::Headers,challenge:String,digest:String)-instance-method","name":"verify_challenge","abstract":false,"args":[{"name":"headers","external_name":"headers","restriction":"HTTP::Headers"},{"name":"challenge","external_name":"challenge","restriction":"String"},{"name":"digest","external_name":"digest","restriction":"String"}],"args_string":"(headers : HTTP::Headers, challenge : String, digest : String)","args_html":"(headers : HTTP::Headers, challenge : String, digest : String)","location":{"filename":"src/main.cr","line_number":77,"url":"https://github.com/ShariqT/socialize/blob/45f41c10f775a5a32f0dd077ff37d1b91fce1941/src/main.cr#L77"},"def":{"name":"verify_challenge","args":[{"name":"headers","external_name":"headers","restriction":"HTTP::Headers"},{"name":"challenge","external_name":"challenge","restriction":"String"},{"name":"digest","external_name":"digest","restriction":"String"}],"visibility":"Public","body":"if headers[\"X-Challenge-Secret\"]?\n  secret = headers[\"X-Challenge-Secret\"]\n  result = OpenSSL::HMAC.hexdigest(OpenSSL::Algorithm::SHA512, secret, \"testchallenge\")\n  return result == digest\nend\nreturn false\n"}}]}]}]}}